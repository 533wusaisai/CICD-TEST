### 文件上传

#### 动态创建文件夹保存

在Koa中实现图片上传并动态创建文件夹保存图片，你可以使用koa-router来处理路由，koa-body或koa-multer来处理文件上传。以下是一个基本的示例，展示了如何使用koa-multer来上传图片并在保存前动态创建文件夹。

首先，你需要安装必要的包：

`npm install koa koa-router koa-multer mkdirp`

这里使用mkdirp库来创建目录，因为它可以递归地创建目录路径。

然后，你可以创建一个简单的Koa服务器，并设置文件上传的路由：

```js
  const Koa = require('koa');
  const Router = require('koa-router');
  const multer = require('koa-multer');
  const mkdirp = require('mkdirp');

  const app = new Koa();
  const router = new Router();

  // 配置 multer
  const storage = multer.diskStorage({
    destination: async function (req, file, cb) {
      // 设置图片保存的文件夹
      const uploadPath = 'uploads/' + getDynamicFolderName();
      // 确保文件夹存在，如果不存在则创建它
      await mkdirp(uploadPath);
      cb(null, uploadPath);
    },
    filename: function (req, file, cb) {
      // 设置文件名
      cb(null, file.fieldname + '-' + Date.now() + getFileExtension(file.originalname));
    }
  });

  const upload = multer({ storage: storage });

  // 获取文件扩展名
  function getFileExtension(filename) {
    return filename.slice(((filename.lastIndexOf(".") - 1) >>> 0) + 2);
  }

  // 根据需要生成动态文件夹名
  function getDynamicFolderName() {
    // 这里使用日期作为文件夹名，你可以根据需要自定义
    const date = new Date();
    const year = date.getFullYear();
    const month = ('0' + (date.getMonth() + 1)).slice(-2);
    const day = ('0' + date.getDate()).slice(-2);
    return `${year}-${month}-${day}`;
  }

  // 上传图片的路由
  router.post('/upload', upload.single('image'), async (ctx) => {
    ctx.body = {
      status: 'success',
      path: ctx.file.path
    };
  });

  app.use(router.routes()).use(router.allowedMethods());

  app.listen(3000, () => {
    console.log('Server is running on http://localhost:3000');
  });
```


在这个例子中，upload.single('image')中间件处理名为image的单个文件上传。storage配置定义了文件应该被保存的位置和文件名。destination函数中使用mkdirp来创建一个包含日期的动态路径，filename函数设置文件名，避免文件名冲突。

确保你的前端表单设置了enctype="multipart/form-data"属性，这样才能正确上传文件。

这个例子提供了一个基本的起点，你可以根据自己的需求进行调整和扩展。例如，你可能需要添加更多的错误处理，或者根据用户会话或其他逻辑来定制文件夹名称。